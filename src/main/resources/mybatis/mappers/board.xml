<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.board">


	<select id="getNoticeList" parameterType="int" resultType="boardVO">
		<![CDATA[
         SELECT z.article_no, z.user_id, z.nickname, z.group_id,
         z.create_date, z.title, z.brackets, z.view_cnt, z.comment_cnt FROM
         	(SELECT ROWNUM as recNum, a.* FROM
         		(SELECT b.article_no, b.user_id, u.nickname,
				b.group_id, b.create_date, b.title, b.brackets, b.view_cnt, b.comment_cnt
         		FROM BOARD_TBL b, USER_TBL u WHERE u.user_id=b.user_id
         		AND b.group_id=#{group_id} AND b.brackets='공지' order by create_date desc) a
         	) z
         WHERE recNum BETWEEN 0 AND 3
      ]]>
	</select>
	
	
	<select id="getTotBoard" parameterType="int" resultType="int">
		<![CDATA[
         SELECT COUNT(*) FROM BOARD_TBL WHERE group_id=#{group_id}
      ]]>
	</select>
	
	
	<select id="getBoardList" parameterType="java.util.Map" resultType="boardVO">
		<![CDATA[
         SELECT * FROM
         	(SELECT ROWNUM as recNum, a.* FROM
         		(SELECT b.article_no, b.user_id, u.nickname, b.group_id, b.create_date, b.title, b.brackets, b.view_cnt, b.comment_cnt
         		FROM BOARD_TBL b, USER_TBL u WHERE u.user_id=b.user_id AND b.group_id=#{group_id} order by b.article_no desc) a
         	)
         WHERE recNum BETWEEN (#{section}-1)*100 + (#{pagenum}-1)*10+1 AND (#{section}-1)*100 + #{pagenum}*10
         	
      ]]>
	</select>
	
	<select id="getBoard" parameterType="int" resultType="boardVO">
		<![CDATA[
         SELECT b.*, u.nickname, u.user_img FROM BOARD_TBL b, USER_TBL u
         WHERE b.article_no=#{article_no} AND b.user_id=u.user_id
      ]]>
	</select>
	
	
	<select id="getCommentsList" parameterType="int" resultType="commentVO">
		<![CDATA[
         SELECT LEVEL, c.*, u.nickname, u.user_img
         FROM COMMENT_TBL c, USER_TBL u
         WHERE u.user_id=c.user_id AND c.article_no=#{article_no}
         START WITH c.parent_no=0
         CONNECT BY PRIOR c.comment_no=c.parent_no
         ORDER SIBLINGS BY c.comment_no
      ]]>
	</select>
	
	
	<update id="updateBoardViewCnt" parameterType="int">
		UPDATE BOARD_TBL SET view_cnt=view_cnt+1 WHERE article_no=#{article_no}
	</update>
	
	
	<select id="getNewArticleNo" resultType="int">
		<![CDATA[
			SELECT MAX(article_no)+1 FROM BOARD_TBL
		 ]]>
	</select>
	
	
	
	<insert id="addBoard" parameterType="boardVO">
		INSERT INTO BOARD_TBL(article_no, user_id, group_id, create_date,
		title, content, brackets, view_cnt, comment_cnt)
		VALUES(#{article_no}, #{user_id}, #{group_id}, sysdate,
		#{title}, #{content}, #{brackets}, 0, 0)
	</insert>
	
	
	<update id="modBoard" parameterType="boardVO">
		UPDATE BOARD_TBL SET title=#{title}, content=#{content}, brackets=#{brackets}
		WHERE article_no=#{article_no}
	</update>
	
	
	
</mapper>